<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crispy Chicken Sales Dashboard</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS for Excel processing -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- Luxon for date handling -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <style>
    :root {
      --primary: #e63946;
      --secondary: #1d3557;
      --light: #f1faee;
      --dark: #457b9d;
      --success: #2a9d8f;
      --warning: #e9c46a;
      --danger: #f4a261;
      --card-bg: #ffffff;
      --border: #dee2e6;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
      color: var(--secondary);
      position: relative;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .subtitle {
      color: #666;
      font-size: 1rem;
    }

    /* Navigation Tabs */
    .nav-tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 8px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      gap: 5px;
    }
    .nav-tab {
      flex: 1;
      padding: 12px 20px;
      text-align: center;
      cursor: pointer;
      border-radius: 8px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .nav-tab.active {
      background: var(--primary);
      color: white;
    }
    .nav-tab:hover:not(.active) {
      background: rgba(29, 53, 87, 0.1);
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    /* Data Management Section */
    .data-management {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    .upload-area {
      flex: 1;
      min-width: 280px;
      border: 3px dashed var(--border);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      background: #f9f9f9;
    }
    .upload-area:hover, .upload-area.dragover {
      border-color: var(--primary);
      background-color: #fdf2f3;
      transform: translateY(-2px);
    }
    .upload-area i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 15px;
    }
    .upload-text {
      font-weight: 600;
      color: var(--secondary);
      font-size: 1.1rem;
    }
    .upload-subtext {
      font-size: 0.9rem;
      color: #888;
      margin-top: 8px;
    }
    .btn {
      padding: 12px 22px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      font-size: 1rem;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 4px rgba(230, 57, 70, 0.3);
    }
    .btn-primary:hover {
      background: #d62839;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(230, 57, 70, 0.4);
    }
    .btn-secondary {
      background: var(--light);
      color: var(--secondary);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      background: #e6f0e9;
      transform: translateY(-1px);
    }

    /* Filters */
    .filters {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    .filter-group {
      display: flex;
      flex-direction: column;
    }
    .filter-group label {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--secondary);
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .filter-group select,
    .filter-group input {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      background: white;
      transition: border-color 0.2s;
    }
    .filter-group select:focus,
    .filter-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
    }

    /* Data Table Section */
    .data-table-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .table-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--secondary);
    }
    .table-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn-icon {
      padding: 10px 15px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      color: var(--secondary);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    .btn-icon:hover {
      background: var(--light);
      border-color: var(--primary);
      color: var(--primary);
    }

    /* DataTable Customization */
    .dataTables_wrapper {
      padding: 0;
    }
    .dataTables_filter input {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      margin-left: 10px;
    }
    .dataTables_filter input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
    }
    .dataTables_length select {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 5px 10px;
      margin: 0 10px;
    }
    .dataTables_paginate .paginate_button {
      padding: 8px 12px;
      margin: 0 2px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: white;
      color: var(--secondary);
      cursor: pointer;
      transition: all 0.2s;
    }
    .dataTables_paginate .paginate_button:hover {
      background: var(--light);
      border-color: var(--primary);
      color: var(--primary);
    }
    .dataTables_paginate .paginate_button.current {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--primary);
    }
    .card-title {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--secondary);
      margin-bottom: 8px;
    }
    .card-subtitle {
      font-size: 0.85rem;
      color: #888;
      margin-top: 5px;
    }
    .card-icon {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 2.5rem;
      opacity: 0.1;
      color: var(--primary);
    }

    /* Chart Container */
    .chart-container {
      position: relative;
      height: 400px;
      margin-bottom: 25px;
    }

    /* Grid for Sections */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }
    @media (max-width: 992px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .data-management {
        flex-direction: column;
        align-items: stretch;
      }
      .filters {
        grid-template-columns: 1fr;
      }
      .summary-cards {
        grid-template-columns: 1fr;
      }
      .nav-tabs {
        flex-direction: column;
      }
      .chart-container {
        height: 300px;
      }
    }

    /* Loading & Error */
    .loading, .error {
      text-align: center;
      padding: 25px;
      border-radius: 12px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .loading {
      background: #e3f2fd;
      color: #1565c0;
    }
    .error {
      background: #ffebee;
      color: #c62828;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 30px 20px;
      color: #888;
      font-size: 0.9rem;
      margin-top: 50px;
      border-top: 1px solid var(--border);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* Data Export */
    .export-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    .export-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn-export {
      padding: 10px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      color: var(--secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-export:hover {
      background: var(--light);
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Data Stats */
    .data-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .stat-card {
      background: linear-gradient(135deg, var(--primary), #d62839);
      color: white;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .stat-title {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 10px;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
    }

    /* Analysis Section */
    .analysis-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
    }
    .analysis-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .analysis-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--secondary);
    }
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .analysis-item {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }
    .analysis-label {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }
    .analysis-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--secondary);
    }

    /* Channel Explanation Section */
    .channel-explanation {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
    }
    .channel-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--secondary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .channel-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .channel-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid var(--primary);
      transition: transform 0.3s ease;
    }
    .channel-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .channel-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--secondary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .channel-description {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 15px;
    }
    .channel-methods {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .channel-method {
      background: var(--light);
      color: var(--secondary);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .channel-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }

    /* Channel Performance Section */
    .channel-performance {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
    }
    .channel-performance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .channel-performance-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--secondary);
    }
    .channel-filters {
      display: flex;
      gap: 10px;
    }
    .channel-filter {
      padding: 8px 15px;
      border: 1px solid var(--border);
      border-radius: 20px;
      background: white;
      color: var(--secondary);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .channel-filter.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    .channel-filter:hover:not(.active) {
      background: var(--light);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-chart-line"></i> Crispy Chicken Sales Dashboard</h1>
      <p class="subtitle">Real-time insights into sales, delivery, and payment performance</p>
    </header>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="overview">
        <i class="fas fa-chart-pie"></i> Overview
      </div>
      <div class="nav-tab" data-tab="channels">
        <i class="fas fa-stream"></i> Sales Channels
      </div>
      <div class="nav-tab" data-tab="raw-data">
        <i class="fas fa-table"></i> Raw Data
      </div>
      <div class="nav-tab" data-tab="analysis">
        <i class="fas fa-analytics"></i> Analysis
      </div>
      <div class="nav-tab" data-tab="reports">
        <i class="fas fa-file-alt"></i> Reports
      </div>
    </div>

    <!-- Overview Tab -->
    <div class="tab-content active" id="overview">
      <!-- Data Management -->
      <div class="data-management">
        <div class="upload-area" id="dropArea">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="upload-text">Drop Excel file here or click to upload</div>
          <p class="upload-subtext">Supports .xlsx, .xls, .csv files up to 10MB</p>
          <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" hidden />
        </div>
        <div style="display: flex; flex-direction: column; gap: 10px;">
          <a href="#" class="btn btn-secondary" id="downloadTemplate">
            <i class="fas fa-download"></i> Download Template
          </a>
          <a href="#" class="btn btn-secondary" id="loadSampleData">
            <i class="fas fa-database"></i> Load Sample Data
          </a>
        </div>
      </div>

      <!-- Export Section -->
      <div class="export-section">
        <div>
          <h3 style="margin-bottom: 5px; color: var(--secondary);">Data Export</h3>
          <p style="color: #666; font-size: 0.9rem;">Export your analysis results</p>
        </div>
        <div class="export-options">
          <button class="btn-export" id="exportPDF">
            <i class="fas fa-file-pdf"></i> Export PDF
          </button>
          <button class="btn-export" id="exportCSV">
            <i class="fas fa-file-csv"></i> Export CSV
          </button>
          <button class="btn-export" id="exportExcel">
            <i class="fas fa-file-excel"></i> Export Excel
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters">
        <div class="filter-group">
          <label for="filterMonth"><i class="fas fa-calendar-alt"></i> Month</label>
          <select id="filterMonth">
            <option value="">All Months</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filterYear"><i class="fas fa-calendar"></i> Year</label>
          <select id="filterYear">
            <option value="">All Years</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filterBranch"><i class="fas fa-store"></i> Branch</label>
          <select id="filterBranch">
            <option value="">All Branches</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filterChannel"><i class="fas fa-stream"></i> Sales Channel</label>
          <select id="filterChannel">
            <option value="">All Channels</option>
            <option value="delivery">Delivery Platforms</option>
            <option value="instore">In-Store</option>
            <option value="callcenter">Call Center Delivery</option>
            <option value="online">Online (Website/App)</option>
          </select>
        </div>
        <div class="filter-group" style="align-self: end;">
          <button class="btn btn-primary" id="applyFilters">
            <i class="fas fa-filter"></i> Apply Filters
          </button>
        </div>
      </div>

      <!-- Data Statistics -->
      <div class="data-stats">
        <div class="stat-card">
          <div class="stat-title">Total Records</div>
          <div class="stat-value" id="totalRecords">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Total Sales</div>
          <div class="stat-value" id="totalSales">AED 0</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Total Orders</div>
          <div class="stat-value" id="totalOrders">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Active Branches</div>
          <div class="stat-value" id="activeBranches">0</div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="card">
          <i class="fas fa-receipt card-icon"></i>
          <div class="card-title">Total Receipts</div>
          <div class="card-value" id="totalReceipts">AED 0</div>
          <div class="card-subtitle">All filtered data</div>
        </div>
        <div class="card">
          <i class="fas fa-motorcycle card-icon"></i>
          <div class="card-title">Delivery Platforms</div>
          <div class="card-value" id="deliveryPlatforms">AED 0</div>
          <div class="card-subtitle">Third-party delivery</div>
        </div>
        <div class="card">
          <i class="fas fa-store card-icon"></i>
          <div class="card-title">In-Store</div>
          <div class="card-value" id="inStore">AED 0</div>
          <div class="card-subtitle">Walk-in or takeaway</div>
        </div>
        <div class="card">
          <i class="fas fa-phone card-icon"></i>
          <div class="card-title">Call Center</div>
          <div class="card-value" id="callCenter">AED 0</div>
          <div class="card-subtitle">Direct delivery</div>
        </div>
        <div class="card">
          <i class="fas fa-globe card-icon"></i>
          <div class="card-title">Online</div>
          <div class="card-value" id="online">AED 0</div>
          <div class="card-subtitle">Website/App orders</div>
        </div>
        <div class="card">
          <i class="fas fa-credit-card card-icon"></i>
          <div class="card-title">Card Payments</div>
          <div class="card-value" id="cardPercentage">0%</div>
          <div class="card-subtitle">of total receipts</div>
        </div>
      </div>

      <!-- Charts -->
      <div class="dashboard-grid">
        <div class="analysis-section">
          <div class="analysis-header">
            <h3 class="analysis-title">Sales Trend</h3>
          </div>
          <div class="chart-container">
            <canvas id="salesTrendChart"></canvas>
          </div>
        </div>
        <div class="analysis-section">
          <div class="analysis-header">
            <h3 class="analysis-title">Channel Distribution</h3>
          </div>
          <div class="chart-container">
            <canvas id="channelDistributionChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Sales Channels Tab -->
    <div class="tab-content" id="channels">
      <!-- Channel Explanation -->
      <div class="channel-explanation">
        <h2 class="channel-title">
          <i class="fas fa-info-circle"></i> Sales Channel Explanation
        </h2>
        <div class="channel-grid">
          <div class="channel-card">
            <div class="channel-icon">
              <i class="fas fa-motorcycle"></i>
            </div>
            <div class="channel-name">Delivery Platforms</div>
            <div class="channel-description">Orders from third-party delivery platforms</div>
            <div class="channel-methods">
              <span class="channel-method">NOON CARD</span>
              <span class="channel-method">Careem CARD</span>
              <span class="channel-method">SMILES CARD</span>
              <span class="channel-method">Keeta CARD</span>
              <span class="channel-method">DELIVERO CARD</span>
            </div>
          </div>
          <div class="channel-card">
            <div class="channel-icon">
              <i class="fas fa-store"></i>
            </div>
            <div class="channel-name">In-Store</div>
            <div class="channel-description">Payments from walk-in or takeaway customers</div>
            <div class="channel-methods">
              <span class="channel-method">Cash</span>
              <span class="channel-method">Visa Card</span>
              <span class="channel-method">Master card</span>
            </div>
          </div>
          <div class="channel-card">
            <div class="channel-icon">
              <i class="fas fa-phone"></i>
            </div>
            <div class="channel-name">Call Center Delivery</div>
            <div class="channel-description">Orders handled by your call center delivery directly</div>
            <div class="channel-methods">
              <span class="channel-method">Delivery Cash</span>
              <span class="channel-method">Delivery CARD</span>
            </div>
          </div>
          <div class="channel-card">
            <div class="channel-icon">
              <i class="fas fa-laptop"></i>
            </div>
            <div class="channel-name">Online (Website/App)</div>
            <div class="channel-description">Orders from your Crispy Chicken website or app</div>
            <div class="channel-methods">
              <span class="channel-method">ONLINE CASH</span>
              <span class="channel-method">ONLINE CARD</span>
            </div>
          </div>
        </div>
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--warning);">
          <p style="font-weight: 600; color: var(--secondary); margin-bottom: 5px;">
            <i class="fas fa-info-circle"></i> Note:
          </p>
          <p style="color: #666;">
            "Receipts" represents the grand total of all payments received for the day — from every channel and platform. It's not a separate payment method but a summary of all channels.
          </p>
        </div>
      </div>

      <!-- Channel Performance -->
      <div class="channel-performance">
        <div class="channel-performance-header">
          <h3 class="channel-performance-title">Channel Performance Analysis</h3>
          <div class="channel-filters">
            <button class="channel-filter active" data-channel="all">All Channels</button>
            <button class="channel-filter" data-channel="delivery">Delivery</button>
            <button class="channel-filter" data-channel="instore">In-Store</button>
            <button class="channel-filter" data-channel="callcenter">Call Center</button>
            <button class="channel-filter" data-channel="online">Online</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="channelPerformanceChart"></canvas>
        </div>
        <div class="dashboard-grid">
          <div class="analysis-section">
            <div class="analysis-header">
              <h3 class="analysis-title">Channel Revenue</h3>
            </div>
            <div class="chart-container">
              <canvas id="channelRevenueChart"></canvas>
            </div>
          </div>
          <div class="analysis-section">
            <div class="analysis-header">
              <h3 class="channel-performance-title">Channel Orders</h3>
            </div>
            <div class="chart-container">
              <canvas id="channelOrdersChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Raw Data Tab -->
    <div class="tab-content" id="raw-data">
      <div class="data-table-section">
        <div class="table-header">
          <h2 class="table-title">Sales Data Table</h2>
          <div class="table-actions">
            <button class="btn-icon" id="refreshTable">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <button class="btn-icon" id="addRecord">
              <i class="fas fa-plus"></i> Add Record
            </button>
            <button class="btn-icon" id="deleteSelected">
              <i class="fas fa-trash"></i> Delete Selected
            </button>
          </div>
        </div>
        <table id="dataTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th><input type="checkbox" id="selectAll"></th>
              <th>Branch</th>
              <th>Month</th>
              <th>Year</th>
              <th>Receipts</th>
              <th>Delivery Platforms</th>
              <th>In-Store</th>
              <th>Call Center</th>
              <th>Online</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Analysis Tab -->
    <div class="tab-content" id="analysis">
      <div class="analysis-section">
        <div class="analysis-header">
          <h3 class="analysis-title">Branch Performance Analysis</h3>
        </div>
        <div class="analysis-grid">
          <div class="analysis-item">
            <div class="analysis-label">Top Performing Branch</div>
            <div class="analysis-value" id="topBranch">-</div>
          </div>
          <div class="analysis-item">
            <div class="analysis-label">Average Order Value</div>
            <div class="analysis-value" id="avgOrderValue">AED 0</div>
          </div>
          <div class="analysis-item">
            <div class="analysis-label">Peak Sales Month</div>
            <div class="analysis-value" id="peakMonth">-</div>
          </div>
          <div class="analysis-item">
            <div class="analysis-label">Most Popular Channel</div>
            <div class="analysis-value" id="popularChannel">-</div>
          </div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="analysis-section">
          <div class="analysis-header">
            <h3 class="analysis-title">Branch Comparison</h3>
          </div>
          <div class="chart-container">
            <canvas id="branchComparisonChart"></canvas>
          </div>
        </div>
        <div class="analysis-section">
          <div class="analysis-header">
            <h3 class="analysis-title">Monthly Performance</h3>
          </div>
          <div class="chart-container">
            <canvas id="monthlyPerformanceChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Tab -->
    <div class="tab-content" id="reports">
      <div class="analysis-section">
        <div class="analysis-header">
          <h3 class="analysis-title">Generate Reports</h3>
          <button class="btn btn-primary" id="generateReport">
            <i class="fas fa-file-export"></i> Generate Report
          </button>
        </div>
        <div class="analysis-grid">
          <div class="analysis-item">
            <div class="analysis-label">Report Type</div>
            <select id="reportType" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
              <option value="summary">Summary Report</option>
              <option value="detailed">Detailed Report</option>
              <option value="financial">Financial Report</option>
              <option value="branch">Branch Report</option>
              <option value="channel">Channel Report</option>
            </select>
          </div>
          <div class="analysis-item">
            <div class="analysis-label">Date Range</div>
            <input type="date" id="reportDateFrom" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
          </div>
          <div class="analysis-item">
            <div class="analysis-label">To</div>
            <input type="date" id="reportDateTo" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
          </div>
          <div class="analysis-item">
            <div class="analysis-label">Format</div>
            <select id="reportFormat" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px;">
              <option value="pdf">PDF</option>
              <option value="excel">Excel</option>
              <option value="csv">CSV</option>
            </select>
          </div>
        </div>
      </div>

      <div class="data-table-section">
        <div class="table-header">
          <h2 class="table-title">Recent Reports</h2>
        </div>
        <table id="reportsTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th>Report Name</th>
              <th>Type</th>
              <th>Generated Date</th>
              <th>Format</th>
              <th>Size</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Monthly Sales Report</td>
              <td>Summary</td>
              <td>2025-01-15</td>
              <td>PDF</td>
              <td>2.3 MB</td>
              <td>
                <button class="btn-icon"><i class="fas fa-download"></i></button>
                <button class="btn-icon"><i class="fas fa-eye"></i></button>
              </td>
            </tr>
            <tr>
              <td>Channel Performance</td>
              <td>Detailed</td>
              <td>2025-01-14</td>
              <td>Excel</td>
              <td>1.8 MB</td>
              <td>
                <button class="btn-icon"><i class="fas fa-download"></i></button>
                <button class="btn-icon"><i class="fas fa-eye"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="loadingMessage" class="loading" style="display: none;">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Processing data...</span>
    </div>
    <div id="errorMessage" class="error" style="display: none;">
      <i class="fas fa-exclamation-circle"></i>
      <span></span>
    </div>
  </div>

  <footer>
    <p>© 2025 Crispy Chicken Analytics | Data updated: <span id="lastUpdated">Never</span></p>
  </footer>

  <script>
    // Global variables
    let rawData = [];
    let filteredData = [];
    let dataTable = null;
    let reportsTable = null;
    let charts = {};
    let currentChannelFilter = 'all';

    // Sample data generation
    const generateSampleData = () => {
      const branches = [
        'Crispy Chicken-Hamdan St',
        'Crispy Chicken Khaldia',
        'Crispy Chicken Shabiya 11',
        'Crispy Chicken Muroor',
        'Crispy Chicken Al Barsha',
        'Crispy Chicken Al Satwa',
        'Crispy Chicken Al Rgga',
        'Crispy Chicken-ELctria'
      ];
      
      const data = [];
      const currentYear = new Date().getFullYear();
      
      for (let year = 2023; year <= currentYear; year++) {
        for (let month = 1; month <= 12; month++) {
          branches.forEach(branch => {
            const receipts = Math.floor(Math.random() * 50000) + 10000;
            const talabat = Math.floor(Math.random() * 8000) + 1000;
            const tabna = Math.floor(Math.random() * 6000) + 500;
            const keeta = Math.floor(Math.random() * 7000) + 800;
            const cash = Math.floor(Math.random() * 10000) + 2000;
            const noon = Math.floor(Math.random() * 6000) + 700;
            const master = Math.floor(Math.random() * 5000) + 500;
            const visa = Math.floor(Math.random() * 7000) + 1000;
            const careem = Math.floor(Math.random() * 5000) + 600;
            const deliveryCard = Math.floor(Math.random() * 4000) + 400;
            const smiles = Math.floor(Math.random() * 3000) + 300;
            const deliveryCash = Math.floor(Math.random() * 5000) + 500;
            const delivero = Math.floor(Math.random() * 4000) + 400;
            const onlineCash = Math.floor(Math.random() * 3000) + 300;
            const onlineCard = Math.floor(Math.random() * 4000) + 400;
            
            data.push({
              'HEAD': 1,
              'Branch': branch,
              'Month': month,
              'Year': year,
              'Receipts': receipts,
              'TALABAT': talabat,
              'TABNA': tabna,
              'Keeta CARD': keeta,
              'Cash': cash,
              'NOON CARD': noon,
              'Master card': master,
              'Visa Card': visa,
              'Careem CARD': careem,
              'Delivery CARD': deliveryCard,
              'SMILES CARD': smiles,
              'Delivery Cash': deliveryCash,
              'DELIVERO CARD': delivero,
              'ONLINE CASH': onlineCash,
              'ONLINE CARD': onlineCard,
              'Count_Receipts': Math.floor(Math.random() * 500) + 100,
              'Count_TALABAT': Math.floor(Math.random() * 100) + 20,
              'Count_TABNA': Math.floor(Math.random() * 80) + 10,
              'Count_Keeta': Math.floor(Math.random() * 90) + 15,
              'Count_Cash': Math.floor(Math.random() * 150) + 30,
              'Count_NOON': Math.floor(Math.random() * 80) + 10,
              'Count_Master': Math.floor(Math.random() * 70) + 10,
              'Count_Visa': Math.floor(Math.random() * 100) + 20,
              'Count_Careem': Math.floor(Math.random() * 70) + 10,
              'Count_DeliveryCard': Math.floor(Math.random() * 60) + 10,
              'Count_SMILES': Math.floor(Math.random() * 50) + 5,
              'Count_DeliveryCash': Math.floor(Math.random() * 80) + 10,
              'Count_DELIVERO': Math.floor(Math.random() * 60) + 10,
              'Count_ONLINE_Cash': Math.floor(Math.random() * 50) + 5,
              'Count_ONLINE_Card': Math.floor(Math.random() * 60) + 10
            });
          });
        }
      }
      
      return data;
    };

    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', function() {
      initializeEventListeners();
      initializeCharts();
      loadSampleData();
    });

    // Initialize event listeners
    function initializeEventListeners() {
      // Tab navigation
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          switchTab(tabName);
        });
      });

      // File upload
      const dropArea = document.getElementById('dropArea');
      const fileInput = document.getElementById('fileInput');
      
      dropArea.addEventListener('click', () => fileInput.click());
      dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('dragover');
      });
      dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('dragover');
      });
      dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('dragover');
        handleFileUpload(e.dataTransfer.files[0]);
      });
      fileInput.addEventListener('change', (e) => {
        handleFileUpload(e.target.files[0]);
      });

      // Buttons
      document.getElementById('loadSampleData').addEventListener('click', loadSampleData);
      document.getElementById('downloadTemplate').addEventListener('click', downloadTemplate);
      document.getElementById('applyFilters').addEventListener('click', applyFilters);
      document.getElementById('exportPDF').addEventListener('click', () => exportData('pdf'));
      document.getElementById('exportCSV').addEventListener('click', () => exportData('csv'));
      document.getElementById('exportExcel').addEventListener('click', () => exportData('excel'));
      document.getElementById('refreshTable').addEventListener('click', refreshTable);
      document.getElementById('addRecord').addEventListener('click', addRecord);
      document.getElementById('deleteSelected').addEventListener('click', deleteSelected);
      document.getElementById('generateReport').addEventListener('click', generateReport);

      // Channel filters
      document.querySelectorAll('.channel-filter').forEach(filter => {
        filter.addEventListener('click', function() {
          document.querySelectorAll('.channel-filter').forEach(f => f.classList.remove('active'));
          this.classList.add('active');
          currentChannelFilter = this.dataset.channel;
          updateChannelCharts();
        });
      });
    }

    // Switch tabs
    function switchTab(tabName) {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      document.getElementById(tabName).classList.add('active');
      
      if (tabName === 'raw-data' && !dataTable) {
        initializeDataTable();
      } else if (tabName === 'reports' && !reportsTable) {
        initializeReportsTable();
      }
    }

    // Load sample data
    function loadSampleData() {
      showLoading();
      rawData = generateSampleData();
      filteredData = [...rawData];
      
      setTimeout(() => {
        updateDashboard();
        hideLoading();
        showNotification('Sample data loaded successfully!', 'success');
      }, 1000);
    }

    // Update dashboard
    function updateDashboard() {
      updateFilters();
      updateStatistics();
      updateSummaryCards();
      updateCharts();
      updateAnalysis();
      updateLastUpdated();
    }

    // Update filter options
    function updateFilters() {
      const months = [...new Set(filteredData.map(d => d.Month))].sort((a, b) => a - b);
      const years = [...new Set(filteredData.map(d => d.Year))].sort((a, b) => b - a);
      const branches = [...new Set(filteredData.map(d => d.Branch))].sort();
      
      updateSelectOptions('filterMonth', months, m => {
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        return monthNames[m - 1];
      });
      updateSelectOptions('filterYear', years);
      updateSelectOptions('filterBranch', branches);
    }

    // Update select options
    function updateSelectOptions(selectId, values, formatter = v => v) {
      const select = document.getElementById(selectId);
      const currentValue = select.value;
      select.innerHTML = '<option value="">All</option>';
      
      values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = formatter(value);
        select.appendChild(option);
      });
      
      select.value = currentValue;
    }

    // Update statistics
    function updateStatistics() {
      const totalRecords = filteredData.length;
      const totalSales = filteredData.reduce((sum, d) => sum + (d.Receipts || 0), 0);
      const totalOrders = filteredData.reduce((sum, d) => sum + (d.Count_Receipts || 0), 0);
      const activeBranches = new Set(filteredData.map(d => d.Branch)).size;
      
      document.getElementById('totalRecords').textContent = totalRecords.toLocaleString();
      document.getElementById('totalSales').textContent = `AED ${totalSales.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();
      document.getElementById('activeBranches').textContent = activeBranches;
    }

    // Update summary cards
    function updateSummaryCards() {
      const totals = {
        receipts: 0,
        delivery: 0,
        instore: 0,
        callcenter: 0,
        online: 0,
        cards: 0
      };
      
      filteredData.forEach(d => {
        totals.receipts += d.Receipts || 0;
        totals.delivery += (d['TALABAT'] || 0) + (d['TABNA'] || 0) + (d['Keeta CARD'] || 0) + 
                           (d['NOON CARD'] || 0) + (d['Careem CARD'] || 0) + (d['SMILES CARD'] || 0) + 
                           (d['DELIVERO CARD'] || 0);
        totals.instore += (d.Cash || 0) + (d['Visa Card'] || 0) + (d['Master card'] || 0);
        totals.callcenter += (d['Delivery Cash'] || 0) + (d['Delivery CARD'] || 0);
        totals.online += (d['ONLINE CASH'] || 0) + (d['ONLINE CARD'] || 0);
        totals.cards += (d['Visa Card'] || 0) + (d['Master card'] || 0) + (d['NOON CARD'] || 0) + 
                       (d['Careem CARD'] || 0) + (d['SMILES CARD'] || 0) + (d['DELIVERO CARD'] || 0) + 
                       (d['ONLINE CARD'] || 0) + (d['Delivery CARD'] || 0);
      });
      
      document.getElementById('totalReceipts').textContent = `AED ${totals.receipts.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('deliveryPlatforms').textContent = `AED ${totals.delivery.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('inStore').textContent = `AED ${totals.instore.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('callCenter').textContent = `AED ${totals.callcenter.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('online').textContent = `AED ${totals.online.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
      document.getElementById('cardPercentage').textContent = `${((totals.cards / totals.receipts) * 100).toFixed(1)}%`;
    }

    // Initialize charts
    function initializeCharts() {
      // Sales Trend Chart
      const salesTrendCtx = document.getElementById('salesTrendChart').getContext('2d');
      charts.salesTrend = new Chart(salesTrendCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Sales Trend',
            data: [],
            borderColor: '#e63946',
            backgroundColor: 'rgba(230, 57, 70, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'AED ' + value.toLocaleString();
                }
              }
            }
          }
        }
      });

      // Channel Distribution Chart
      const channelDistCtx = document.getElementById('channelDistributionChart').getContext('2d');
      charts.channelDistribution = new Chart(channelDistCtx, {
        type: 'doughnut',
        data: {
          labels: ['Delivery Platforms', 'In-Store', 'Call Center', 'Online'],
          datasets: [{
            data: [],
            backgroundColor: ['#e63946', '#1d3557', '#457b9d', '#2a9d8f']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Channel Performance Chart
      const channelPerfCtx = document.getElementById('channelPerformanceChart').getContext('2d');
      charts.channelPerformance = new Chart(channelPerfCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Revenue',
            data: [],
            backgroundColor: '#e63946'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'AED ' + value.toLocaleString();
                }
              }
            }
          }
        }
      });

      // Channel Revenue Chart
      const channelRevCtx = document.getElementById('channelRevenueChart').getContext('2d');
      charts.channelRevenue = new Chart(channelRevCtx, {
        type: 'pie',
        data: {
          labels: [],
          datasets: [{
            data: [],
            backgroundColor: ['#e63946', '#1d3557', '#457b9d', '#2a9d8f', '#e9c46a', '#f4a261']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });

      // Channel Orders Chart
      const channelOrdersCtx = document.getElementById('channelOrdersChart').getContext('2d');
      charts.channelOrders = new Chart(channelOrdersCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Orders',
            data: [],
            backgroundColor: '#457b9d'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Branch Comparison Chart
      const branchCompCtx = document.getElementById('branchComparisonChart').getContext('2d');
      charts.branchComparison = new Chart(branchCompCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Total Sales',
            data: [],
            backgroundColor: '#e63946'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'AED ' + value.toLocaleString();
                }
              }
            }
          }
        }
      });

      // Monthly Performance Chart
      const monthlyPerfCtx = document.getElementById('monthlyPerformanceChart').getContext('2d');
      charts.monthlyPerformance = new Chart(monthlyPerfCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Monthly Sales',
            data: [],
            borderColor: '#2a9d8f',
            backgroundColor: 'rgba(42, 157, 143, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'AED ' + value.toLocaleString();
                }
              }
            }
          }
        }
      });
    }

    // Update charts
    function updateCharts() {
      updateSalesTrendChart();
      updateChannelDistributionChart();
      updateChannelCharts();
      updateBranchComparisonChart();
      updateMonthlyPerformanceChart();
    }

    // Update sales trend chart
    function updateSalesTrendChart() {
      const monthlyData = {};
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      filteredData.forEach(d => {
        const key = `${d.Year}-${d.Month}`;
        if (!monthlyData[key]) {
          monthlyData[key] = 0;
        }
        monthlyData[key] += d.Receipts || 0;
      });
      
      const sortedKeys = Object.keys(monthlyData).sort();
      const labels = sortedKeys.map(k => {
        const [year, month] = k.split('-');
        return `${monthNames[parseInt(month) - 1]} ${year}`;
      });
      const data = sortedKeys.map(k => monthlyData[k]);
      
      charts.salesTrend.data.labels = labels;
      charts.salesTrend.data.datasets[0].data = data;
      charts.salesTrend.update();
    }

    // Update channel distribution chart
    function updateChannelDistributionChart() {
      const totals = {
        delivery: 0,
        instore: 0,
        callcenter: 0,
        online: 0
      };
      
      filteredData.forEach(d => {
        totals.delivery += (d['TALABAT'] || 0) + (d['TABNA'] || 0) + (d['Keeta CARD'] || 0) + 
                          (d['NOON CARD'] || 0) + (d['Careem CARD'] || 0) + (d['SMILES CARD'] || 0) + 
                          (d['DELIVERO CARD'] || 0);
        totals.instore += (d.Cash || 0) + (d['Visa Card'] || 0) + (d['Master card'] || 0);
        totals.callcenter += (d['Delivery Cash'] || 0) + (d['Delivery CARD'] || 0);
        totals.online += (d['ONLINE CASH'] || 0) + (d['ONLINE CARD'] || 0);
      });
      
      charts.channelDistribution.data.datasets[0].data = [
        totals.delivery,
        totals.instore,
        totals.callcenter,
        totals.online
      ];
      charts.channelDistribution.update();
    }

    // Update channel charts
    function updateChannelCharts() {
      let data = filteredData;
      
      if (currentChannelFilter !== 'all') {
        // Apply channel filter logic here
      }
      
      // Update channel performance chart
      const channelMethods = {
        'TALABAT': 0,
        'TABNA': 0,
        'Keeta CARD': 0,
        'NOON CARD': 0,
        'Careem CARD': 0,
        'SMILES CARD': 0,
        'DELIVERO CARD': 0,
        'Cash': 0,
        'Visa Card': 0,
        'Master card': 0,
        'Delivery Cash': 0,
        'Delivery CARD': 0,
        'ONLINE CASH': 0,
        'ONLINE CARD': 0
      };
      
      const channelOrders = {
        'TALABAT': 0,
        'TABNA': 0,
        'Keeta CARD': 0,
        'NOON CARD': 0,
        'Careem CARD': 0,
        'SMILES CARD': 0,
        'DELIVERO CARD': 0,
        'Cash': 0,
        'Visa Card': 0,
        'Master card': 0,
        'Delivery Cash': 0,
        'Delivery CARD': 0,
        'ONLINE CASH': 0,
        'ONLINE CARD': 0
      };
      
      data.forEach(d => {
        Object.keys(channelMethods).forEach(method => {
          channelMethods[method] += d[method] || 0;
          channelOrders[method] += d[`Count_${method.replace(' ', '')}`] || 0;
        });
      });
      
      // Sort by revenue
      const sortedMethods = Object.entries(channelMethods)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      
      charts.channelPerformance.data.labels = sortedMethods.map(m => m[0]);
      charts.channelPerformance.data.datasets[0].data = sortedMethods.map(m => m[1]);
      charts.channelPerformance.update();
      
      charts.channelRevenue.data.labels = sortedMethods.map(m => m[0]);
      charts.channelRevenue.data.datasets[0].data = sortedMethods.map(m => m[1]);
      charts.channelRevenue.update();
      
      charts.channelOrders.data.labels = sortedMethods.map(m => m[0]);
      charts.channelOrders.data.datasets[0].data = sortedMethods.map(m => channelOrders[m[0]]);
      charts.channelOrders.update();
    }

    // Update branch comparison chart
    function updateBranchComparisonChart() {
      const branchData = {};
      
      filteredData.forEach(d => {
        if (!branchData[d.Branch]) {
          branchData[d.Branch] = 0;
        }
        branchData[d.Branch] += d.Receipts || 0;
      });
      
      const sortedBranches = Object.entries(branchData)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      
      charts.branchComparison.data.labels = sortedBranches.map(b => b[0]);
      charts.branchComparison.data.datasets[0].data = sortedBranches.map(b => b[1]);
      charts.branchComparison.update();
    }

    // Update monthly performance chart
    function updateMonthlyPerformanceChart() {
      const monthlyData = {};
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      filteredData.forEach(d => {
        const monthName = monthNames[d.Month - 1];
        if (!monthlyData[monthName]) {
          monthlyData[monthName] = 0;
        }
        monthlyData[monthName] += d.Receipts || 0;
      });
      
      const labels = monthNames.filter(m => monthlyData[m]);
      const data = labels.map(m => monthlyData[m]);
      
      charts.monthlyPerformance.data.labels = labels;
      charts.monthlyPerformance.data.datasets[0].data = data;
      charts.monthlyPerformance.update();
    }

    // Update analysis
    function updateAnalysis() {
      // Top performing branch
      const branchData = {};
      filteredData.forEach(d => {
        if (!branchData[d.Branch]) {
          branchData[d.Branch] = 0;
        }
        branchData[d.Branch] += d.Receipts || 0;
      });
      const topBranch = Object.entries(branchData).sort((a, b) => b[1] - a[1])[0];
      document.getElementById('topBranch').textContent = topBranch ? topBranch[0] : '-';
      
      // Average order value
      const totalSales = filteredData.reduce((sum, d) => sum + (d.Receipts || 0), 0);
      const totalOrders = filteredData.reduce((sum, d) => sum + (d.Count_Receipts || 0), 0);
      const avgOrderValue = totalOrders > 0 ? totalSales / totalOrders : 0;
      document.getElementById('avgOrderValue').textContent = `AED ${avgOrderValue.toFixed(2)}`;
      
      // Peak sales month
      const monthlyData = {};
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      filteredData.forEach(d => {
        const monthName = monthNames[d.Month - 1];
        if (!monthlyData[monthName]) {
          monthlyData[monthName] = 0;
        }
        monthlyData[monthName] += d.Receipts || 0;
      });
      const peakMonth = Object.entries(monthlyData).sort((a, b) => b[1] - a[1])[0];
      document.getElementById('peakMonth').textContent = peakMonth ? peakMonth[0] : '-';
      
      // Most popular channel
      const channelTotals = {
        'Delivery Platforms': 0,
        'In-Store': 0,
        'Call Center': 0,
        'Online': 0
      };
      
      filteredData.forEach(d => {
        channelTotals['Delivery Platforms'] += (d['TALABAT'] || 0) + (d['TABNA'] || 0) + (d['Keeta CARD'] || 0) + 
                                              (d['NOON CARD'] || 0) + (d['Careem CARD'] || 0) + (d['SMILES CARD'] || 0) + 
                                              (d['DELIVERO CARD'] || 0);
        channelTotals['In-Store'] += (d.Cash || 0) + (d['Visa Card'] || 0) + (d['Master card'] || 0);
        channelTotals['Call Center'] += (d['Delivery Cash'] || 0) + (d['Delivery CARD'] || 0);
        channelTotals['Online'] += (d['ONLINE CASH'] || 0) + (d['ONLINE CARD'] || 0);
      });
      
      const popularChannel = Object.entries(channelTotals).sort((a, b) => b[1] - a[1])[0];
      document.getElementById('popularChannel').textContent = popularChannel ? popularChannel[0] : '-';
    }

    // Apply filters
    function applyFilters() {
      const month = document.getElementById('filterMonth').value;
      const year = document.getElementById('filterYear').value;
      const branch = document.getElementById('filterBranch').value;
      const channel = document.getElementById('filterChannel').value;
      
      filteredData = rawData.filter(d => {
        if (month && d.Month != month) return false;
        if (year && d.Year != year) return false;
        if (branch && d.Branch !== branch) return false;
        
        if (channel) {
          const channelValue = getChannelValue(d, channel);
          if (channelValue === 0) return false;
        }
        
        return true;
      });
      
      updateDashboard();
      showNotification('Filters applied successfully!', 'success');
    }

    // Get channel value
    function getChannelValue(data, channel) {
      switch(channel) {
        case 'delivery':
          return (data['TALABAT'] || 0) + (data['TABNA'] || 0) + (data['Keeta CARD'] || 0) + 
                 (data['NOON CARD'] || 0) + (data['Careem CARD'] || 0) + (data['SMILES CARD'] || 0) + 
                 (data['DELIVERO CARD'] || 0);
        case 'instore':
          return (data.Cash || 0) + (data['Visa Card'] || 0) + (data['Master card'] || 0);
        case 'callcenter':
          return (data['Delivery Cash'] || 0) + (data['Delivery CARD'] || 0);
        case 'online':
          return (data['ONLINE CASH'] || 0) + (data['ONLINE CARD'] || 0);
        default:
          return 0;
      }
    }

    // Initialize data table
    function initializeDataTable() {
      dataTable = $('#dataTable').DataTable({
        data: filteredData.map(d => [
          `<input type="checkbox" class="row-select">`,
          d.Branch,
          d.Month,
          d.Year,
          `AED ${(d.Receipts || 0).toLocaleString()}`,
          `AED ${getChannelValue(d, 'delivery').toLocaleString()}`,
          `AED ${getChannelValue(d, 'instore').toLocaleString()}`,
          `AED ${getChannelValue(d, 'callcenter').toLocaleString()}`,
          `AED ${getChannelValue(d, 'online').toLocaleString()}`,
          `<button class="btn-icon" onclick="editRecord('${d.Branch}', ${d.Month}, ${d.Year})"><i class="fas fa-edit"></i></button>`
        ]),
        columns: [
          { title: '', orderable: false },
          { title: 'Branch' },
          { title: 'Month' },
          { title: 'Year' },
          { title: 'Receipts' },
          { title: 'Delivery Platforms' },
          { title: 'In-Store' },
          { title: 'Call Center' },
          { title: 'Online' },
          { title: 'Actions', orderable: false }
        ],
        pageLength: 25,
        responsive: true
      });
    }

    // Initialize reports table
    function initializeReportsTable() {
      reportsTable = $('#reportsTable').DataTable({
        pageLength: 10,
        responsive: true
      });
    }

    // Refresh table
    function refreshTable() {
      if (dataTable) {
        dataTable.clear();
        dataTable.rows.add(filteredData.map(d => [
          `<input type="checkbox" class="row-select">`,
          d.Branch,
          d.Month,
          d.Year,
          `AED ${(d.Receipts || 0).toLocaleString()}`,
          `AED ${getChannelValue(d, 'delivery').toLocaleString()}`,
          `AED ${getChannelValue(d, 'instore').toLocaleString()}`,
          `AED ${getChannelValue(d, 'callcenter').toLocaleString()}`,
          `AED ${getChannelValue(d, 'online').toLocaleString()}`,
          `<button class="btn-icon" onclick="editRecord('${d.Branch}', ${d.Month}, ${d.Year})"><i class="fas fa-edit"></i></button>`
        ]));
        dataTable.draw();
      }
      showNotification('Table refreshed!', 'success');
    }

    // Add record
    function addRecord() {
      showNotification('Add record feature coming soon!', 'info');
    }

    // Delete selected
    function deleteSelected() {
      const selected = document.querySelectorAll('.row-select:checked');
      if (selected.length === 0) {
        showNotification('Please select records to delete', 'warning');
        return;
      }
      
      if (confirm(`Are you sure you want to delete ${selected.length} record(s)?`)) {
        showNotification(`${selected.length} record(s) deleted!`, 'success');
        refreshTable();
      }
    }

    // Edit record
    function editRecord(branch, month, year) {
      showNotification(`Edit record for ${branch} - ${month}/${year}`, 'info');
    }

    // Generate report
    function generateReport() {
      const reportType = document.getElementById('reportType').value;
      const dateFrom = document.getElementById('reportDateFrom').value;
      const dateTo = document.getElementById('reportDateTo').value;
      const format = document.getElementById('reportFormat').value;
      
      showNotification(`Generating ${reportType} report in ${format.toUpperCase()} format...`, 'info');
      
      setTimeout(() => {
        showNotification('Report generated successfully!', 'success');
      }, 2000);
    }

    // Export data
    function exportData(format) {
      if (filteredData.length === 0) {
        showNotification('No data to export!', 'warning');
        return;
      }
      
      switch(format) {
        case 'pdf':
          exportToPDF();
          break;
        case 'csv':
          exportToCSV();
          break;
        case 'excel':
          exportToExcel();
          break;
      }
    }

    // Export to PDF
    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.text('Crispy Chicken Sales Report', 20, 20);
      doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 30);
      doc.text(`Total Records: ${filteredData.length}`, 20, 40);
      doc.text(`Total Sales: AED ${filteredData.reduce((sum, d) => sum + (d.Receipts || 0), 0).toLocaleString()}`, 20, 50);
      
      doc.save('crispy_chicken_report.pdf');
      showNotification('PDF exported successfully!', 'success');
    }

    // Export to CSV
    function exportToCSV() {
      const headers = Object.keys(filteredData[0]);
      const csvContent = [
        headers.join(','),
        ...filteredData.map(row => headers.map(h => row[h]).join(','))
      ].join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'crispy_chicken_data.csv';
      a.click();
      
      showNotification('CSV exported successfully!', 'success');
    }

    // Export to Excel
    function exportToExcel() {
      const ws = XLSX.utils.json_to_sheet(filteredData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Sales Data');
      XLSX.writeFile(wb, 'crispy_chicken_data.xlsx');
      
      showNotification('Excel exported successfully!', 'success');
    }

    // Download template
    function downloadTemplate() {
      const template = [
        {
          'HEAD': 1,
          'Branch': 'Crispy Chicken-Hamdan St',
          'Month': 1,
          'Year': 2024,
          'Receipts': 0,
          'TALABAT': 0,
          'TABNA': 0,
          'Keeta CARD': 0,
          'Cash': 0,
          'NOON CARD': 0,
          'Master card': 0,
          'Visa Card': 0,
          'Careem CARD': 0,
          'Delivery CARD': 0,
          'SMILES CARD': 0,
          'Delivery Cash': 0,
          'DELIVERO CARD': 0,
          'ONLINE CASH': 0,
          'ONLINE CARD': 0
        }
      ];
      
      const ws = XLSX.utils.json_to_sheet(template);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Template');
      XLSX.writeFile(wb, 'crispy_chicken_template.xlsx');
      
      showNotification('Template downloaded successfully!', 'success');
    }

    // Handle file upload
    function handleFileUpload(file) {
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[sheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);
          
          rawData = jsonData;
          filteredData = [...rawData];
          updateDashboard();
          
          showNotification('File uploaded successfully!', 'success');
        } catch (error) {
          showNotification('Error processing file: ' + error.message, 'error');
        }
      };
      reader.readAsArrayBuffer(file);
    }

    // Show loading
    function showLoading() {
      document.getElementById('loadingMessage').style.display = 'flex';
    }

    // Hide loading
    function hideLoading() {
      document.getElementById('loadingMessage').style.display = 'none';
    }

    // Show notification
    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
      `;
      
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${type === 'success' ? '#2a9d8f' : type === 'error' ? '#e63946' : '#457b9d'};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideIn 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // Update last updated
    function updateLastUpdated() {
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    }

    // Add animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
